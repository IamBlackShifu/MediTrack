<!doctype html>

<html
  lang="en"
  class="light-style layout-menu-fixed layout-compact"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="../assets/"
  data-template="vertical-menu-template-free"
  data-style="light">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>PathoGuide | Analysis</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon/Logo.png" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet" />

    <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="../assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <link rel="stylesheet" href="../assets/vendor/libs/apex-charts/apex-charts.css" />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="../assets/vendor/js/helpers.js"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../assets/js/config.js"></script>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <div class="app-brand demo">
            <a href="home.html" class="app-brand-link d-flex align-items-center">
              <span class="app-brand-logo demo">
                <img src="../assets/img/favicon/Logo.png" alt="PathoGuide Logo" style="width: 60px; height: 60px;" />
              </span>
              <span class="app-brand-text demo menu-text fw-bold ms-2" style="font-size: 1.5rem;">PathoGuide</span>
            </a>
            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
              <i class="bx bx-chevron-left bx-sm d-flex align-items-center justify-content-center"></i>
            </a>
          </div>

          <div class="menu-inner-shadow"></div>

          <ul class="menu-inner py-1">
            <!-- Dashboards -->
            <li class="menu-item active open">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-home-smile"></i>
                <div class="text-truncate" data-i18n="Dashboards">Dashboard</div>
               
              </a>
          
              <ul class="menu-sub">
                
                
                <li class="menu-item">
                  <a href="javascript:void(0);" class="menu-link menu-toggle">
                    <i class="menu-icon tf-icons bx bx-dock-top"></i>
                    <div class="text-truncate" data-i18n="Lab">Lab</div>
                  </a>
                  <ul class="menu-sub">
                    <li class="menu-item active">
                      <a href="home.html" class="menu-link">
                        <div class="text-truncate" data-i18n="Analytics">Back To Dashboard</div>
                      </a>
                    </li>
                    <li class="menu-item active">
                      <a href="analytics.html" class="menu-link">
                        <div class="text-truncate" data-i18n="Analytics">Analytics</div>
                      </a>
                    </li>
                    <li class="menu-item active">
                      <a href="phamarcy-capturing-page.html" class="menu-link">
                        <div class="text-truncate" data-i18n="Pharmacy">Pharmacy</div>
                      </a>
                    </li>
                  </ul>
                

            
           
            <!-- Pages -->
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-dock-top"></i>
                <div class="text-truncate" data-i18n="Account Settings">Account Settings</div>
              </a>
              <ul class="menu-sub">
                
             
              <li class="menu-item active">
                <a href="update-profile.html" class="menu-link">
                  <div class="text-truncate" data-i18n="Basic">Update Profile</div>
                </a>
              </li>
              <li class="menu-item active">
                <a href="forgotpassword.html" class="menu-link">
                  <div class="text-truncate" data-i18n="Basic">Reset Password</div>
                </a>
              </li>
            
             

          </li>
              
            
           
           
                
              </ul>
            </li>

            <!-- Extended components -->
            
            
            </li>
            <!-- Misc -->
            
          </ul>
            
            <li class="menu-item">
              <a href="support.html" class="menu-link">
                <i class="menu-icon tf-icons bx bx-support"></i>
                <div class="text-truncate" data-i18n="Support">Support</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="../index.html" class="menu-link">
                <i class="menu-icon tf-icons bx bx-log-out"></i> <!-- Logout icon added -->
                <div class="text-truncate" data-i18n="Basic">Logout</div>
              </a>
            </li>
            
          </ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          <nav
            class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
            id="layout-navbar">
            <div class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0 d-xl-none">
              <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
                <i class="bx bx-menu bx-md"></i>
              </a>
            </div>

            <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
              <!-- Search -->
              <div class="navbar-nav align-items-center">
                <div class="nav-item d-flex align-items-center position-relative"> <!-- Added position-relative -->
                  <i class="bx bx-search bx-md"></i>
                  <input type="text" id="search-bar" class="form-control border-0 shadow-none ps-1 ps-sm-2" placeholder="Search..." aria-label="Search..." />
                  <div id="search-results" class="search-results"></div> <!-- Added class for styling -->
                </div>
              </div>
              
              <!-- /Search -->
              <style>
                /* Styling for the search results container */
                #search-results {
                  position: absolute;
                  top: 100%; /* Place it below the search bar */
                  left: 0;
                  right: 0;
                  background-color: white;
                  border: 1px solid #ccc;
                  max-height: 200px;
                  overflow-y: auto;
                  z-index: 1000;
                }
              
                /* Styling for individual search results */
                #search-results div {
                  padding: 8px;
                  cursor: pointer;
                }
              
                #search-results div:hover {
                  background-color: #f0f0f0;
                }
              </style>
              
              <script>
                const searchBar = document.getElementById('search-bar');
                const searchResults = document.getElementById('search-results');
              
                const index = [
                  { title: 'Dashboard', url: 'home.html', keywords: ['home', 'dashboard'] },
                  { title: 'Support', url: 'support.html', keywords: ['support', 'help'] },
                 
                  { title: 'Pharmacy', url: 'pharmacy-capturing-page.html', keywords: ['pharmacy'] },
                  { title: 'Update Profile', url: 'update-profile.html', keywords: ['update profile', 'update', 'profile', 'account settings'] },
                  
                  { title: 'Forgot Password', url: 'forgotpassword.html', keywords: ['forgot', 'password'] },
                  { title: 'User Guide', url: 'user-guide.html', keywords: ['user', 'guide'] },
                  { title: 'Privacy Policy', url: 'privacy-policy.html', keywords: ['privacy', 'policy'] },
                  { title: 'Troubleshooting', url: 'troubleshooting.html', keywords: ['troubleshooting', 'help'] },
                  { title: 'Analytics', url: 'analytics.html', keywords: ['analytics'] },
                  // Add more pages and keywords to the index
                ];
              
                searchBar.addEventListener('keyup', (event) => {
                  const query = event.target.value.toLowerCase();
              
                  // Clear results if the search bar is empty
                  if (query === '') {
                    searchResults.innerHTML = '';
                    return; // Exit the function early
                  }
              
                  // Filter pages based on the query
                  const results = index.filter(page => {
                    const keywords = page.keywords.join(' ').toLowerCase();
                    return keywords.includes(query);
                  });
              
                  // Clear previous results
                  searchResults.innerHTML = '';
              
                  // Display new results
                  results.forEach(page => {
                    const resultDiv = document.createElement('div'); // Create a new div for each result
                    const link = document.createElement('a');
                    link.href = page.url;
                    link.textContent = page.title;
                    resultDiv.appendChild(link); // Append the link to the div
                    searchResults.appendChild(resultDiv); // Append the div to the search results
                  });
                });
              </script>
              

              <ul class="navbar-nav flex-row align-items-center ms-auto">
                <!-- Place this tag where you want the button to render. -->
                

                <!-- User -->
                <li class="nav-item navbar-dropdown dropdown-user dropdown">
                
                  <script>
                    function updateClock() {
                      const now = new Date();
                      const hours = now.getHours().toString().padStart(2, '0');
                      const minutes = now.getMinutes().toString().padStart(2, '0');
                      const seconds = now.getSeconds().toString().padStart(2, '0');
                      const timeString = `${hours}:${minutes}:${seconds}`;
                      
                      document.getElementById('clock').textContent = timeString;
                    }
                    
                    // Update the clock every second
                    setInterval(updateClock, 1000);
                    
                    // Initial call to display the clock immediately
                    updateClock();
                  </script>
                  <div class="clock" id="clock" style="color: blue;"></div>
                 
                </li>
                <!--/ User -->
              </ul>
            </div>
          </nav>

        

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->
            <div class="container-xxl flex-grow-1 container-p-y">
              <!-- Dashboard Header -->
              <div class="d-flex justify-content-between align-items-center mb-6">
                <div>
                  <h4 class="fw-bold mb-2">🩺 Clinician Analytics Dashboard</h4>
                  <p class="text-muted mb-0">Comprehensive patient data insights and clinical analytics</p>
                </div>
                <div class="d-flex gap-3">
                  <button type="button" class="btn btn-outline-primary" onclick="ClinicianAnalytics.refreshDashboard()">
                    <i class="bx bx-refresh me-2"></i>Refresh
                  </button>
                  <div class="dropdown">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown">
                      <i class="bx bx-export me-2"></i>Export
                    </button>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.exportReport()">
                        <i class="bx bx-file-doc me-2"></i>Export Report
                      </a></li>
                      <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.exportTableData()">
                        <i class="bx bx-table me-2"></i>Export Table
                      </a></li>
                      <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.emailReport()">
                        <i class="bx bx-envelope me-2"></i>Email Report
                      </a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.scheduleReport()">
                        <i class="bx bx-calendar me-2"></i>Schedule Reports
                      </a></li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Quick Statistics Cards -->
              <div class="row g-6 mb-6">
                <div class="col-sm-6 col-xl-3">
                  <div class="card">
                    <div class="card-body">
                      <div class="d-flex align-items-start justify-content-between">
                        <div class="content-left">
                          <span class="text-heading">Total Patients</span>
                          <div class="d-flex align-items-center my-1">
                            <h4 class="mb-0 me-2" id="totalPatients">0</h4>
                            <p class="text-success mb-0" id="patientsGrowth">(+0%)</p>
                          </div>
                          <small class="mb-0">This month</small>
                        </div>
                        <div class="avatar">
                          <span class="avatar-initial rounded bg-label-primary">
                            <i class="bx bx-user bx-lg"></i>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-xl-3">
                  <div class="card">
                    <div class="card-body">
                      <div class="d-flex align-items-start justify-content-between">
                        <div class="content-left">
                          <span class="text-heading">Active Cases</span>
                          <div class="d-flex align-items-center my-1">
                            <h4 class="mb-0 me-2" id="activeCases">0</h4>
                            <p class="text-warning mb-0" id="casesChange">(+0)</p>
                          </div>
                          <small class="mb-0">Currently treating</small>
                        </div>
                        <div class="avatar">
                          <span class="avatar-initial rounded bg-label-warning">
                            <i class="bx bx-clinic bx-lg"></i>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-xl-3">
                  <div class="card">
                    <div class="card-body">
                      <div class="d-flex align-items-start justify-content-between">
                        <div class="content-left">
                          <span class="text-heading">Samples Collected</span>
                          <div class="d-flex align-items-center my-1">
                            <h4 class="mb-0 me-2" id="samplesCollected">0</h4>
                            <p class="text-info mb-0" id="samplesIncrease">(+0)</p>
                          </div>
                          <small class="mb-0">Lab submissions</small>
                        </div>
                        <div class="avatar">
                          <span class="avatar-initial rounded bg-label-info">
                            <i class="bx bx-test-tube bx-lg"></i>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-6 col-xl-3">
                  <div class="card">
                    <div class="card-body">
                      <div class="d-flex align-items-start justify-content-between">
                        <div class="content-left">
                          <span class="text-heading">Recovery Rate</span>
                          <div class="d-flex align-items-center my-1">
                            <h4 class="mb-0 me-2" id="recoveryRate">0%</h4>
                            <p class="text-success mb-0" id="recoveryImprovement">(+0%)</p>
                          </div>
                          <small class="mb-0">Treatment success</small>
                        </div>
                        <div class="avatar">
                          <span class="avatar-initial rounded bg-label-success">
                            <i class="bx bx-heart bx-lg"></i>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Advanced Filters -->
              <div class="card mb-6">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="mb-0">
                    <i class="bx bx-filter-alt me-2"></i>Advanced Filters
                  </h5>
                  <button type="button" class="btn btn-sm btn-outline-secondary" onclick="ClinicianAnalytics.resetFilters()">
                    <i class="bx bx-reset me-1"></i>Reset
                  </button>
                </div>
                <div class="card-body">
                  <form id="clinicianFilters" class="row g-4">
                    <!-- Date Range -->
                    <div class="col-md-3">
                      <label class="form-label">Date Range</label>
                      <select class="form-control" id="dateRange" name="dateRange" onchange="ClinicianAnalytics.handleDateRangeChange()">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month" selected>This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Range</option>
                      </select>
                    </div>

                    <!-- Custom Date Range (Hidden by default) -->
                    <div class="col-md-6" id="customDateRange" style="display: none;">
                      <div class="row">
                        <div class="col-6">
                          <label class="form-label">Start Date</label>
                          <input type="date" class="form-control" name="startDate">
                        </div>
                        <div class="col-6">
                          <label class="form-label">End Date</label>
                          <input type="date" class="form-control" name="endDate">
                        </div>
                      </div>
                    </div>

                    <!-- Infection Type -->
                    <div class="col-md-3">
                      <label class="form-label">Infection Type</label>
                      <select class="form-control" name="infectionType">
                        <option value="">All Infections</option>
                        <option value="Respiratory Infections">Respiratory Infections</option>
                        <option value="Urinary Tract Infections">Urinary Tract Infections</option>
                        <option value="Gastrointestinal System">Gastrointestinal System</option>
                        <option value="Skin And Soft Tissue">Skin And Soft Tissue</option>
                        <option value="Central Nervous System">Central Nervous System</option>
                        <option value="Cardiovascular System">Cardiovascular System</option>
                        <option value="Blood Stream Infections">Blood Stream Infections</option>
                        <option value="Reproductive System">Reproductive System</option>
                        <option value="Bones and Joints">Bones and Joints</option>
                        <option value="Ear, Nose And Throat">Ear, Nose And Throat</option>
                      </select>
                    </div>

                    <!-- Age Group -->
                    <div class="col-md-3">
                      <label class="form-label">Age Group</label>
                      <select class="form-control" name="ageGroup">
                        <option value="">All Ages</option>
                        <option value="0-12">Children (0-12)</option>
                        <option value="13-18">Teenagers (13-18)</option>
                        <option value="19-35">Young Adults (19-35)</option>
                        <option value="36-55">Adults (36-55)</option>
                        <option value="56+">Seniors (56+)</option>
                      </select>
                    </div>

                    <!-- Patient ID -->
                    <div class="col-md-3">
                      <label class="form-label">Patient ID</label>
                      <input type="text" class="form-control" name="patientID" placeholder="Enter Patient ID">
                    </div>

                    <!-- Sample Status -->
                    <div class="col-md-3">
                      <label class="form-label">Sample Status</label>
                      <select class="form-control" name="sampleStatus">
                        <option value="">All Statuses</option>
                        <option value="collected">Collected</option>
                        <option value="processing">Processing</option>
                        <option value="completed">Completed</option>
                        <option value="pending">Pending</option>
                      </select>
                    </div>

                    <!-- Treatment Priority -->
                    <div class="col-md-3">
                      <label class="form-label">Priority</label>
                      <select class="form-control" name="priority">
                        <option value="">All Priorities</option>
                        <option value="low">Low</option>
                        <option value="normal">Normal</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                      </select>
                    </div>

                    <!-- Apply Filters Button -->
                    <div class="col-12">
                      <button type="button" class="btn btn-primary" onclick="ClinicianAnalytics.applyFilters()">
                        <i class="bx bx-search me-2"></i>Apply Filters
                      </button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Charts Section -->
              <div class="row g-6 mb-6">
                <!-- Patient Trends Chart -->
                <div class="col-12 col-lg-8">
                  <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                      <h5 class="mb-0">Patient Visit Trends</h5>
                      <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                          View Options
                        </button>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.changeChartPeriod('daily')">Daily View</a></li>
                          <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.changeChartPeriod('weekly')">Weekly View</a></li>
                          <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.changeChartPeriod('monthly')">Monthly View</a></li>
                        </ul>
                      </div>
                    </div>
                    <div class="card-body">
                      <div id="patientTrendsChart"></div>
                    </div>
                  </div>
                </div>

                <!-- Treatment Outcomes -->
                <div class="col-12 col-lg-4">
                  <div class="card">
                    <div class="card-header">
                      <h5 class="mb-0">Treatment Outcomes</h5>
                    </div>
                    <div class="card-body">
                      <div id="treatmentOutcomesChart"></div>
                    </div>
                  </div>
                </div>

                <!-- Diagnosis Distribution -->
                <div class="col-12 col-lg-6">
                  <div class="card">
                    <div class="card-header">
                      <h5 class="mb-0">Top Diagnoses</h5>
                    </div>
                    <div class="card-body">
                      <div id="diagnosisDistributionChart"></div>
                    </div>
                  </div>
                </div>

                <!-- Patient Demographics -->
                <div class="col-12 col-lg-6">
                  <div class="card">
                    <div class="card-header">
                      <h5 class="mb-0">Patient Demographics</h5>
                    </div>
                    <div class="card-body">
                      <div id="patientDemographicsChart"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Detailed Analytics Table -->
              <div class="card mb-6">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <div>
                    <h5 class="mb-0">Detailed Patient Records</h5>
                    <small class="text-muted">Comprehensive view of all patient interactions</small>
                  </div>
                  <div class="d-flex gap-2">
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="ClinicianAnalytics.exportTableData()">
                      <i class="bx bx-export me-1"></i>Export
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="ClinicianAnalytics.printTable()">
                      <i class="bx bx-printer me-1"></i>Print
                    </button>
                  </div>
                </div>
                <div class="card-body">
                  <!-- Table Controls -->
                  <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="d-flex align-items-center gap-3">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="selectAll" onchange="ClinicianAnalytics.toggleSelectAll()">
                        <label class="form-check-label" for="selectAll">Select All</label>
                      </div>
                      <span class="text-muted">|</span>
                      <small class="text-muted">Showing <span id="recordsCount">0</span> records</small>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                      <small class="text-muted">Rows per page:</small>
                      <select class="form-select form-select-sm" style="width: auto;" onchange="ClinicianAnalytics.changeItemsPerPage(this.value)">
                        <option value="25">25</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                      </select>
                    </div>
                  </div>

                  <!-- Analytics Table -->
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead class="table-light">
                        <tr>
                          <th width="50">
                            <input type="checkbox" class="form-check-input" id="headerCheckbox">
                          </th>
                          <th>Date & Time</th>
                          <th>Patient ID</th>
                          <th>Age</th>
                          <th>Gender</th>
                          <th>Diagnosis</th>
                          <th>Treatment</th>
                          <th>Sample Status</th>
                          <th>Priority</th>
                          <th>Follow-up</th>
                          <th width="120">Actions</th>
                        </tr>
                      </thead>
                      <tbody id="clinicianTableBody">
                        <!-- Table data will be populated by JavaScript -->
                        <tr>
                          <td colspan="11" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="text-muted mt-2 mb-0">Loading patient data...</p>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <!-- Pagination -->
                  <nav aria-label="Analytics pagination" class="mt-4">
                    <ul class="pagination justify-content-center" id="clinicianPagination">
                      <!-- Pagination will be populated by JavaScript -->
                    </ul>
                  </nav>
                </div>
              </div>

              <!-- Clinical Insights & Recommendations -->
              <div class="card">
                <div class="card-header">
                  <div class="d-flex align-items-center">
                    <div class="avatar avatar-sm me-3">
                      <span class="avatar-initial rounded bg-label-info">
                        <i class="bx bx-brain bx-lg"></i>
                      </span>
                    </div>
                    <div>
                      <h5 class="mb-0">AI Clinical Insights</h5>
                      <small class="text-muted">Intelligent recommendations based on patient data patterns</small>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <div id="clinicalInsights" class="row g-4">
                    <!-- AI insights will be populated here -->
                    <div class="col-12 text-center py-5">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Generating insights...</span>
                      </div>
                      <p class="text-muted mt-2 mb-0">Analyzing patient data patterns...</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
         
            <!-- / Content -->
  
            <!-- Footer -->
            <footer class="content-footer footer bg-footer-theme">
              <div class="container-xxl">
                <div
                  class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column">
                  <div class="text-body">
                    ©
                    <script>
                      document.write(new Date().getFullYear());
                    </script>
                    PathoGuide |
                    <a href="https://infinitylinesofcode.com" target="_blank" class="footer-link">Infinity Lines of Code</a>
                  </div>
                  
                </div>
              </div>
            </footer>
            <!-- / Footer -->
  
            <div class="content-backdrop fade"></div>
          </div>
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->

   

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->

    <script src="../assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../assets/vendor/libs/popper/popper.js"></script>
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="../assets/vendor/js/menu.js"></script>

    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="../assets/vendor/libs/apex-charts/apexcharts.js"></script>

    <!-- MediTrack Modular System -->
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/error-manager.js"></script>
    <script src="../assets/js/loading-feedback.js"></script>
    <script src="../assets/js/auth-manager.js"></script>
    <script src="../assets/js/form-validator.js"></script>
    <script src="../assets/js/form-handler.js"></script>
    
    <!-- Main JS -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/meditrack-main.js" data-handler="meditrack"></script>

    <!-- Page JS -->
    <script src="../assets/js/dashboards-analytics.js"></script>

    <!-- Place this tag before closing body tag for github widget button. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    
    <!-- Clinician Analytics Module -->
    <script>
    /**
     * MediTrack Clinician Analytics Dashboard
     * Comprehensive patient analytics and clinical insights for healthcare providers
     */
    window.ClinicianAnalytics = {
        // Configuration
        config: {
            charts: {},
            currentFilters: {},
            currentPage: 1,
            itemsPerPage: 50,
            autoRefreshInterval: 300000 // 5 minutes
        },

        /**
         * Initialize the clinician analytics dashboard
         */
        init: function() {
            console.log('🩺 Initializing Clinician Analytics Dashboard...');
            
            // Set default date range to current month
            this.setDefaultDateRange();
            
            // Initialize charts
            this.initializeCharts();
            
            // Load initial data
            this.loadDashboardData();
            
            // Set up auto-refresh
            this.setupAutoRefresh();
            
            console.log('✅ Clinician Analytics Dashboard ready!');
        },

        /**
         * Set default date range to current month
         */
        setDefaultDateRange: function() {
            const now = new Date();
            const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
            const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            
            this.config.currentFilters = {
                startDate: firstDay.toISOString().split('T')[0],
                endDate: lastDay.toISOString().split('T')[0],
                dateRange: 'month'
            };
        },

        /**
         * Initialize all charts
         */
        initializeCharts: function() {
            // Patient Trends Chart
            this.config.charts.patientTrends = new ApexCharts(document.querySelector('#patientTrendsChart'), {
                chart: {
                    type: 'area',
                    height: 350,
                    toolbar: { show: true },
                    animations: { enabled: true }
                },
                series: [{
                    name: 'Patient Visits',
                    data: []
                }, {
                    name: 'New Patients',
                    data: []
                }],
                xaxis: {
                    type: 'datetime',
                    labels: { format: 'MMM dd' }
                },
                yaxis: {
                    title: { text: 'Number of Patients' }
                },
                colors: ['#696cff', '#71dd37'],
                stroke: {
                    curve: 'smooth',
                    width: 2
                },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.3,
                        opacityTo: 0.1
                    }
                },
                title: {
                    text: 'Daily Patient Trends',
                    align: 'left'
                }
            });

            // Treatment Outcomes Pie Chart
            this.config.charts.treatmentOutcomes = new ApexCharts(document.querySelector('#treatmentOutcomesChart'), {
                chart: {
                    type: 'donut',
                    height: 300
                },
                series: [],
                labels: [],
                colors: ['#71dd37', '#ffab00', '#ff3e1d', '#8592a3'],
                legend: {
                    position: 'bottom'
                },
                plotOptions: {
                    pie: {
                        donut: {
                            size: '70%',
                            labels: {
                                show: true,
                                total: {
                                    show: true,
                                    label: 'Total',
                                    formatter: function (w) {
                                        return w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                                    }
                                }
                            }
                        }
                    }
                }
            });

            // Diagnosis Distribution Bar Chart
            this.config.charts.diagnosisDistribution = new ApexCharts(document.querySelector('#diagnosisDistributionChart'), {
                chart: {
                    type: 'bar',
                    height: 300,
                    horizontal: true
                },
                series: [{
                    name: 'Cases',
                    data: []
                }],
                xaxis: {
                    categories: []
                },
                colors: ['#696cff'],
                title: {
                    text: 'Most Common Diagnoses',
                    align: 'left'
                }
            });

            // Patient Demographics Chart
            this.config.charts.patientDemographics = new ApexCharts(document.querySelector('#patientDemographicsChart'), {
                chart: {
                    type: 'bar',
                    height: 300
                },
                series: [{
                    name: 'Male',
                    data: []
                }, {
                    name: 'Female',
                    data: []
                }],
                xaxis: {
                    categories: ['0-12', '13-18', '19-35', '36-55', '56+']
                },
                colors: ['#696cff', '#ff3e8c'],
                title: {
                    text: 'Patient Age & Gender Distribution',
                    align: 'left'
                },
                plotOptions: {
                    bar: {
                        horizontal: false,
                        columnWidth: '55%',
                    }
                }
            });

            // Render all charts
            Object.values(this.config.charts).forEach(chart => chart.render());
        },

        /**
         * Load dashboard data
         */
        loadDashboardData: async function() {
            try {
                LoadingManager.showSpinner(document.body, {
                    message: 'Loading clinical analytics...',
                    overlay: true
                });

                // Fetch data from API
                const data = await this.fetchClinicianData();
                
                // Update stats cards
                this.updateStatsCards(data);
                
                // Update charts
                this.updateCharts(data);
                
                // Update table
                this.updateClinicianTable(data);
                
                // Generate clinical insights
                this.generateClinicalInsights(data);

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                NotificationManager.showToast({
                    title: 'Error',
                    message: 'Failed to load clinical data',
                    type: 'error'
                });
            } finally {
                LoadingManager.hideSpinner();
            }
        },

        /**
         * Fetch clinician data from API
         */
        fetchClinicianData: async function() {
            const { startDate, endDate, infectionType, ageGroup, patientID, sampleStatus, priority } = this.config.currentFilters;
            
            // Build query parameters
            const queryParams = new URLSearchParams();
            
            if (startDate) queryParams.append('filters[datetime][$gte]', startDate);
            if (endDate) queryParams.append('filters[datetime][$lte]', endDate);
            if (infectionType) queryParams.append('filters[condition][$eq]', infectionType);
            if (patientID) queryParams.append('filters[patientid][$eq]', patientID);

            const response = await ApiHelper.get(`${MediTrackConfig.endpoints.clinicProcessings}?populate=*&${queryParams}`);
            
            if (!response.success) {
                throw new Error('Failed to fetch clinical data');
            }

            return this.processClinicianData(response.data?.data || []);
        },

        /**
         * Process raw API data into clinical analytics format
         */
        processClinicianData: function(rawData) {
            const processedData = {
                totalPatients: new Set(),
                activeCases: 0,
                samplesCollected: rawData.length,
                recoveredPatients: 0,
                patientTrends: {},
                treatmentOutcomes: { 'Recovered': 0, 'Improving': 0, 'Critical': 0, 'Stable': 0 },
                diagnosisDistribution: {},
                demographics: {
                    male: { '0-12': 0, '13-18': 0, '19-35': 0, '36-55': 0, '56+': 0 },
                    female: { '0-12': 0, '13-18': 0, '19-35': 0, '36-55': 0, '56+': 0 }
                },
                tableData: []
            };

            rawData.forEach(item => {
                const record = item.attributes;
                const date = new Date(record.datetime).toISOString().split('T')[0];
                const age = parseInt(record.age);
                const gender = record.sex?.toLowerCase() || 'unknown';
                
                // Count unique patients
                processedData.totalPatients.add(record.patientid);
                
                // Count by date for trends
                processedData.patientTrends[date] = (processedData.patientTrends[date] || 0) + 1;
                
                // Count by diagnosis
                processedData.diagnosisDistribution[record.condition] = 
                    (processedData.diagnosisDistribution[record.condition] || 0) + 1;
                
                // Demographics
                let ageGroup;
                if (age <= 12) ageGroup = '0-12';
                else if (age <= 18) ageGroup = '13-18';
                else if (age <= 35) ageGroup = '19-35';
                else if (age <= 55) ageGroup = '36-55';
                else ageGroup = '56+';
                
                if (gender === 'male' || gender === 'female') {
                    processedData.demographics[gender][ageGroup]++;
                }
                
                // Simulate treatment outcomes and status (replace with real data)
                const outcomes = ['Recovered', 'Improving', 'Critical', 'Stable'];
                const outcome = outcomes[Math.floor(Math.random() * outcomes.length)];
                processedData.treatmentOutcomes[outcome]++;
                
                if (outcome === 'Recovered') processedData.recoveredPatients++;
                if (Math.random() > 0.7) processedData.activeCases++;
                
                // Treatment priority and status
                const priorities = ['Low', 'Normal', 'High', 'Urgent'];
                const statuses = ['Collected', 'Processing', 'Completed', 'Pending'];
                
                // Table data
                processedData.tableData.push({
                    id: item.id,
                    datetime: Utils.formatDateTime(record.datetime),
                    patientID: record.patientid,
                    age: record.age,
                    gender: record.sex || 'Unknown',
                    diagnosis: record.condition,
                    treatment: record.processingdata?.map(p => p.drugused).join(', ') || 'Pending',
                    sampleStatus: statuses[Math.floor(Math.random() * statuses.length)],
                    priority: priorities[Math.floor(Math.random() * priorities.length)],
                    followUp: Math.random() > 0.5 ? Utils.formatDate(new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)) : 'N/A',
                    outcome: outcome
                });
            });

            // Convert set to count
            processedData.totalPatients = processedData.totalPatients.size;

            return processedData;
        },

        /**
         * Update statistics cards
         */
        updateStatsCards: function(data) {
            document.getElementById('totalPatients').textContent = data.totalPatients.toLocaleString();
            document.getElementById('activeCases').textContent = data.activeCases.toLocaleString();
            document.getElementById('samplesCollected').textContent = data.samplesCollected.toLocaleString();
            
            const recoveryRate = data.totalPatients > 0 ? Math.round((data.recoveredPatients / data.totalPatients) * 100) : 0;
            document.getElementById('recoveryRate').textContent = recoveryRate + '%';
            
            // Update growth indicators (simulate growth)
            document.getElementById('patientsGrowth').textContent = '+' + Math.floor(Math.random() * 15) + '%';
            document.getElementById('casesChange').textContent = '+' + Math.floor(Math.random() * 8);
            document.getElementById('samplesIncrease').textContent = '+' + Math.floor(Math.random() * 12);
            document.getElementById('recoveryImprovement').textContent = '+' + Math.floor(Math.random() * 5) + '%';
        },

        /**
         * Update all charts with new data
         */
        updateCharts: function(data) {
            // Update patient trends chart
            const trendsData = Object.entries(data.patientTrends).map(([date, count]) => ({
                x: new Date(date).getTime(),
                y: count
            }));
            
            // Simulate new vs returning patients
            const newPatientsData = trendsData.map(point => ({
                x: point.x,
                y: Math.floor(point.y * 0.3) // Assume 30% are new patients
            }));
            
            this.config.charts.patientTrends.updateSeries([{
                name: 'Total Visits',
                data: trendsData
            }, {
                name: 'New Patients',
                data: newPatientsData
            }]);

            // Update treatment outcomes chart
            const outcomeLabels = Object.keys(data.treatmentOutcomes);
            const outcomeValues = Object.values(data.treatmentOutcomes);
            
            this.config.charts.treatmentOutcomes.updateOptions({
                labels: outcomeLabels
            });
            this.config.charts.treatmentOutcomes.updateSeries(outcomeValues);

            // Update diagnosis distribution chart (top 10)
            const sortedDiagnoses = Object.entries(data.diagnosisDistribution)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);
            
            this.config.charts.diagnosisDistribution.updateOptions({
                xaxis: {
                    categories: sortedDiagnoses.map(([diagnosis]) => diagnosis.length > 25 ? diagnosis.substring(0, 25) + '...' : diagnosis)
                }
            });
            this.config.charts.diagnosisDistribution.updateSeries([{
                name: 'Cases',
                data: sortedDiagnoses.map(([, count]) => count)
            }]);

            // Update demographics chart
            const ageGroups = ['0-12', '13-18', '19-35', '36-55', '56+'];
            const maleData = ageGroups.map(group => data.demographics.male[group] || 0);
            const femaleData = ageGroups.map(group => data.demographics.female[group] || 0);
            
            this.config.charts.patientDemographics.updateSeries([{
                name: 'Male',
                data: maleData
            }, {
                name: 'Female',
                data: femaleData
            }]);
        },

        /**
         * Update clinician table
         */
        updateClinicianTable: function(data) {
            const tbody = document.getElementById('clinicianTableBody');
            const startIndex = (this.config.currentPage - 1) * this.config.itemsPerPage;
            const endIndex = startIndex + this.config.itemsPerPage;
            const pageData = data.tableData.slice(startIndex, endIndex);

            // Update records count
            document.getElementById('recordsCount').textContent = data.tableData.length;

            if (pageData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="text-center text-muted py-5">
                            <i class="bx bx-data bx-lg mb-3 d-block"></i>
                            No patient data found for the selected filters
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = pageData.map(row => `
                <tr>
                    <td><input type="checkbox" class="form-check-input row-select" value="${row.id}"></td>
                    <td><span class="fw-medium">${row.datetime}</span></td>
                    <td><span class="badge bg-primary">${row.patientID}</span></td>
                    <td>${row.age}</td>
                    <td>
                        <i class="bx ${row.gender === 'male' ? 'bx-male' : row.gender === 'female' ? 'bx-female' : 'bx-user'} me-1"></i>
                        ${row.gender}
                    </td>
                    <td><span class="text-truncate d-inline-block" style="max-width: 150px;" title="${row.diagnosis}">${row.diagnosis}</span></td>
                    <td><span class="text-truncate d-inline-block" style="max-width: 200px;" title="${row.treatment}">${row.treatment}</span></td>
                    <td><span class="badge ${this.getStatusBadgeClass(row.sampleStatus)}">${row.sampleStatus}</span></td>
                    <td><span class="badge ${this.getPriorityBadgeClass(row.priority)}">${row.priority}</span></td>
                    <td>${row.followUp}</td>
                    <td>
                        <div class="dropdown">
                            <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="bx bx-dots-vertical-rounded"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.viewPatientDetails('${row.id}')"><i class="bx bx-show me-2"></i>View Details</a></li>
                                <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.editPatientRecord('${row.id}')"><i class="bx bx-edit me-2"></i>Edit Record</a></li>
                                <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.scheduleFollowUp('${row.id}')"><i class="bx bx-calendar me-2"></i>Schedule Follow-up</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="javascript:void(0)" onclick="ClinicianAnalytics.exportPatientData('${row.id}')"><i class="bx bx-export me-2"></i>Export</a></li>
                            </ul>
                        </div>
                    </td>
                </tr>
            `).join('');

            // Update pagination
            this.updatePagination(data.tableData.length);
        },

        /**
         * Get badge class for sample status
         */
        getStatusBadgeClass: function(status) {
            const classes = {
                'Collected': 'bg-info',
                'Processing': 'bg-warning',
                'Completed': 'bg-success',
                'Pending': 'bg-secondary'
            };
            return classes[status] || 'bg-secondary';
        },

        /**
         * Get badge class for priority
         */
        getPriorityBadgeClass: function(priority) {
            const classes = {
                'Low': 'bg-success',
                'Normal': 'bg-info',
                'High': 'bg-warning',
                'Urgent': 'bg-danger'
            };
            return classes[priority] || 'bg-secondary';
        },

        /**
         * Update pagination
         */
        updatePagination: function(totalItems) {
            const totalPages = Math.ceil(totalItems / this.config.itemsPerPage);
            const pagination = document.getElementById('clinicianPagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <li class="page-item ${this.config.currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="javascript:void(0)" onclick="ClinicianAnalytics.changePage(${this.config.currentPage - 1})">
                        <i class="bx bx-chevron-left"></i>
                    </a>
                </li>
            `;

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= this.config.currentPage - 2 && i <= this.config.currentPage + 2)) {
                    paginationHTML += `
                        <li class="page-item ${i === this.config.currentPage ? 'active' : ''}">
                            <a class="page-link" href="javascript:void(0)" onclick="ClinicianAnalytics.changePage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === this.config.currentPage - 3 || i === this.config.currentPage + 3) {
                    paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }

            // Next button
            paginationHTML += `
                <li class="page-item ${this.config.currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="javascript:void(0)" onclick="ClinicianAnalytics.changePage(${this.config.currentPage + 1})">
                        <i class="bx bx-chevron-right"></i>
                    </a>
                </li>
            `;

            pagination.innerHTML = paginationHTML;
        },

        /**
         * Generate AI-powered clinical insights
         */
        generateClinicalInsights: function(data) {
            const insights = document.getElementById('clinicalInsights');
            
            // Simulate AI insights generation
            setTimeout(() => {
                const insightCards = [
                    {
                        icon: 'bx-trending-up',
                        title: 'Patient Volume Trend',
                        message: 'Patient visits have increased by 18% this month. Consider scheduling additional staff during peak hours.',
                        type: 'info',
                        action: 'Optimize Scheduling',
                        actionFn: 'optimizeScheduling'
                    },
                    {
                        icon: 'bx-shield-alt-2',
                        title: 'High-Risk Pattern Detected',
                        message: 'Elderly patients with respiratory infections show 25% longer recovery times. Enhanced monitoring recommended.',
                        type: 'warning',
                        action: 'Review Protocols',
                        actionFn: 'reviewProtocols'
                    },
                    {
                        icon: 'bx-pill',
                        title: 'Treatment Effectiveness',
                        message: 'Current antibiotic protocols show 92% success rate. Consider updating treatment guidelines based on recent efficacy data.',
                        type: 'success',
                        action: 'Update Guidelines',
                        actionFn: 'updateGuidelines'
                    },
                    {
                        icon: 'bx-time-five',
                        title: 'Follow-up Opportunity',
                        message: '15 patients are due for follow-up visits this week. Proactive outreach could improve recovery outcomes.',
                        type: 'info',
                        action: 'Schedule Follow-ups',
                        actionFn: 'scheduleFollowUps'
                    },
                    {
                        icon: 'bx-chart',
                        title: 'Seasonal Pattern',
                        message: 'Respiratory infections typically peak in next 2 weeks. Prepare additional resources and prevention measures.',
                        type: 'warning',
                        action: 'Prepare Resources',
                        actionFn: 'prepareResources'
                    },
                    {
                        icon: 'bx-medal',
                        title: 'Quality Metric',
                        message: 'Patient satisfaction scores improved by 12% with current treatment protocols. Excellent work!',
                        type: 'success',
                        action: 'View Feedback',
                        actionFn: 'viewFeedback'
                    }
                ];

                insights.innerHTML = insightCards.map(insight => `
                    <div class="col-md-6">
                        <div class="alert alert-${insight.type === 'warning' ? 'warning' : insight.type === 'success' ? 'success' : 'info'} d-flex">
                            <div class="me-3">
                                <i class="bx ${insight.icon} bx-lg"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="alert-heading mb-2">${insight.title}</h6>
                                <p class="mb-2">${insight.message}</p>
                                <button type="button" class="btn btn-sm btn-outline-${insight.type === 'warning' ? 'warning' : insight.type === 'success' ? 'success' : 'info'}" onclick="ClinicianAnalytics.${insight.actionFn}()">
                                    ${insight.action}
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }, 2000);
        },

        /**
         * Handle date range change
         */
        handleDateRangeChange: function() {
            const dateRange = document.getElementById('dateRange').value;
            const customDateRange = document.getElementById('customDateRange');
            
            if (dateRange === 'custom') {
                customDateRange.style.display = 'block';
            } else {
                customDateRange.style.display = 'none';
                this.setDateRangePreset(dateRange);
            }
        },

        /**
         * Set preset date range
         */
        setDateRangePreset: function(preset) {
            const now = new Date();
            let startDate, endDate;

            switch (preset) {
                case 'today':
                    startDate = endDate = now.toISOString().split('T')[0];
                    break;
                case 'week':
                    startDate = new Date(now.setDate(now.getDate() - 7)).toISOString().split('T')[0];
                    endDate = new Date().toISOString().split('T')[0];
                    break;
                case 'month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().split('T')[0];
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString().split('T')[0];
                    break;
                case 'quarter':
                    const quarter = Math.floor(now.getMonth() / 3);
                    startDate = new Date(now.getFullYear(), quarter * 3, 1).toISOString().split('T')[0];
                    endDate = new Date(now.getFullYear(), (quarter + 1) * 3, 0).toISOString().split('T')[0];
                    break;
                case 'year':
                    startDate = new Date(now.getFullYear(), 0, 1).toISOString().split('T')[0];
                    endDate = new Date(now.getFullYear(), 11, 31).toISOString().split('T')[0];
                    break;
            }

            this.config.currentFilters.startDate = startDate;
            this.config.currentFilters.endDate = endDate;
            this.config.currentFilters.dateRange = preset;
        },

        /**
         * Apply filters and refresh data
         */
        applyFilters: function() {
            const form = document.getElementById('clinicianFilters');
            const formData = new FormData(form);
            
            // Update current filters
            for (let [key, value] of formData.entries()) {
                if (value) {
                    this.config.currentFilters[key] = value;
                }
            }

            // Handle custom date range
            if (this.config.currentFilters.dateRange === 'custom') {
                this.config.currentFilters.startDate = formData.get('startDate');
                this.config.currentFilters.endDate = formData.get('endDate');
            }

            // Reset to first page
            this.config.currentPage = 1;
            
            // Reload data
            this.loadDashboardData();
        },

        /**
         * Reset all filters
         */
        resetFilters: function() {
            document.getElementById('clinicianFilters').reset();
            document.getElementById('dateRange').value = 'month';
            document.getElementById('customDateRange').style.display = 'none';
            
            this.setDefaultDateRange();
            this.config.currentPage = 1;
            this.loadDashboardData();
        },

        /**
         * Refresh entire dashboard
         */
        refreshDashboard: function() {
            NotificationManager.showToast({
                title: 'Refreshing Dashboard',
                message: 'Loading latest patient data...',
                type: 'info',
                duration: 2000
            });
            
            this.loadDashboardData();
        },

        /**
         * Change chart time period
         */
        changeChartPeriod: function(period) {
            console.log('Changing chart period to:', period);
            NotificationManager.showToast({
                title: 'Chart View Updated',
                message: `Switched to ${period} view`,
                type: 'success'
            });
        },

        /**
         * Change items per page
         */
        changeItemsPerPage: function(newSize) {
            this.config.itemsPerPage = parseInt(newSize);
            this.config.currentPage = 1;
            this.loadDashboardData();
        },

        /**
         * Change table page
         */
        changePage: function(page) {
            this.config.currentPage = page;
            this.loadDashboardData();
        },

        /**
         * Toggle select all checkboxes
         */
        toggleSelectAll: function() {
            const selectAll = document.getElementById('selectAll');
            const rowSelects = document.querySelectorAll('.row-select');
            
            rowSelects.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        },

        /**
         * View patient details
         */
        viewPatientDetails: function(patientId) {
            ModalManager.show('Patient Details', `
                <div class="row g-3">
                    <div class="col-12">
                        <h6>Patient ID: ${patientId}</h6>
                        <p>Detailed patient information will be displayed here...</p>
                        <div class="alert alert-info">
                            <i class="bx bx-info-circle me-2"></i>
                            Complete patient history, treatment records, and lab results.
                        </div>
                    </div>
                </div>
            `, 'Close');
        },

        /**
         * Edit patient record
         */
        editPatientRecord: function(patientId) {
            ModalManager.show('Edit Patient Record', `
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label">Patient ID</label>
                        <input type="text" class="form-control" value="${patientId}" readonly>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Age</label>
                        <input type="number" class="form-control" placeholder="Enter age">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Gender</label>
                        <select class="form-control">
                            <option>Male</option>
                            <option>Female</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Diagnosis</label>
                        <textarea class="form-control" rows="3" placeholder="Enter diagnosis details"></textarea>
                    </div>
                </div>
            `, 'Save Changes', () => {
                NotificationManager.showToast({
                    title: 'Record Updated',
                    message: 'Patient record has been updated successfully',
                    type: 'success'
                });
            });
        },

        /**
         * Schedule follow-up
         */
        scheduleFollowUp: function(patientId) {
            ModalManager.show('Schedule Follow-up', `
                <div class="row g-3">
                    <div class="col-12">
                        <h6>Patient ID: ${patientId}</h6>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Follow-up Date</label>
                        <input type="date" class="form-control" id="followUpDate">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Follow-up Time</label>
                        <input type="time" class="form-control" id="followUpTime">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" rows="3" placeholder="Follow-up notes..."></textarea>
                    </div>
                </div>
            `, 'Schedule', () => {
                NotificationManager.showToast({
                    title: 'Follow-up Scheduled',
                    message: 'Patient follow-up has been scheduled successfully',
                    type: 'success'
                });
            });
        },

        /**
         * Export patient data
         */
        exportPatientData: function(patientId) {
            NotificationManager.showToast({
                title: 'Export Started',
                message: `Exporting data for patient ${patientId}`,
                type: 'success'
            });
        },

        /**
         * Export table data
         */
        exportTableData: function() {
            NotificationManager.showToast({
                title: 'Export Started',
                message: 'Generating patient data CSV export...',
                type: 'info'
            });
        },

        /**
         * Export complete report
         */
        exportReport: function() {
            ModalManager.show('Export Clinical Report', `
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label">Report Type</label>
                        <select class="form-control" id="reportType">
                            <option value="comprehensive">Comprehensive Clinical Report</option>
                            <option value="summary">Executive Summary</option>
                            <option value="trends">Trend Analysis Report</option>
                            <option value="outcomes">Treatment Outcomes Report</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Format</label>
                        <select class="form-control" id="exportFormat">
                            <option value="pdf">PDF Report</option>
                            <option value="excel">Excel Spreadsheet</option>
                            <option value="word">Word Document</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Include Charts</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeCharts" checked>
                            <label class="form-check-label" for="includeCharts">
                                Include all visualization charts
                            </label>
                        </div>
                    </div>
                </div>
            `, 'Export', () => {
                const reportType = document.getElementById('reportType').value;
                const format = document.getElementById('exportFormat').value;
                
                NotificationManager.showToast({
                    title: 'Export Started',
                    message: `Generating ${reportType} in ${format.toUpperCase()} format...`,
                    type: 'success'
                });
            });
        },

        /**
         * Print table
         */
        printTable: function() {
            window.print();
        },

        /**
         * Email report
         */
        emailReport: function() {
            ModalManager.show('Email Clinical Report', `
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label">Recipient Email</label>
                        <input type="email" class="form-control" id="recipientEmail" placeholder="Enter email address">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Subject</label>
                        <input type="text" class="form-control" id="emailSubject" value="Clinical Analytics Report">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Message</label>
                        <textarea class="form-control" id="emailMessage" rows="3" placeholder="Add a message...">Please find the attached clinical analytics report.</textarea>
                    </div>
                </div>
            `, 'Send Email', () => {
                const email = document.getElementById('recipientEmail').value;
                if (email) {
                    NotificationManager.showToast({
                        title: 'Email Sent',
                        message: `Clinical report sent to ${email}`,
                        type: 'success'
                    });
                }
            });
        },

        /**
         * Schedule report
         */
        scheduleReport: function() {
            ModalManager.show('Schedule Clinical Reports', `
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Frequency</label>
                        <select class="form-control" id="scheduleFrequency">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Time</label>
                        <input type="time" class="form-control" id="scheduleTime" value="08:00">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Report Type</label>
                        <select class="form-control" id="scheduledReportType">
                            <option value="summary">Daily Summary</option>
                            <option value="comprehensive">Comprehensive Report</option>
                            <option value="trends">Trend Analysis</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Email Recipients</label>
                        <input type="email" class="form-control" id="scheduleEmails" placeholder="Enter email addresses (comma separated)">
                    </div>
                </div>
            `, 'Schedule', () => {
                NotificationManager.showToast({
                    title: 'Reports Scheduled',
                    message: 'Automated clinical reports have been configured',
                    type: 'success'
                });
            });
        },

        // Clinical Insight Action Functions
        optimizeScheduling: function() {
            NotificationManager.showToast({
                title: 'Scheduling Optimization',
                message: 'Opening staff scheduling recommendations...',
                type: 'info'
            });
        },

        reviewProtocols: function() {
            NotificationManager.showToast({
                title: 'Protocol Review',
                message: 'Opening treatment protocol guidelines...',
                type: 'info'
            });
        },

        updateGuidelines: function() {
            NotificationManager.showToast({
                title: 'Guidelines Update',
                message: 'Opening treatment guideline editor...',
                type: 'info'
            });
        },

        scheduleFollowUps: function() {
            NotificationManager.showToast({
                title: 'Follow-up Scheduling',
                message: 'Opening follow-up appointment scheduler...',
                type: 'info'
            });
        },

        prepareResources: function() {
            NotificationManager.showToast({
                title: 'Resource Preparation',
                message: 'Opening resource management dashboard...',
                type: 'info'
            });
        },

        viewFeedback: function() {
            NotificationManager.showToast({
                title: 'Patient Feedback',
                message: 'Opening patient satisfaction reports...',
                type: 'info'
            });
        },

        /**
         * Setup auto-refresh
         */
        setupAutoRefresh: function() {
            setInterval(() => {
                this.loadDashboardData();
            }, this.config.autoRefreshInterval);
        }
    };

    // Initialize clinician analytics when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        // Wait for MediTrack main system to initialize first
        setTimeout(() => {
            ClinicianAnalytics.init();
        }, 1000);
    });
    </script>
  </body>
</html>
