<!doctype html>
<html lang="en" class="light-style layout-wide customizer-hide" dir="ltr" data-theme="theme-default" data-assets-path="assets/" data-template="vertical-menu-template-free" data-style="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
  <title>MediTrack | Login</title>
  <meta name="description" content="" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="assets/img/favicon/favicon.ico" />
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
  
  <link rel="stylesheet" href="assets/vendor/fonts/boxicons.css" />
  
  <!-- Core CSS -->
  <link rel="stylesheet" href="assets/vendor/css/core.css" />
  <link rel="stylesheet" href="assets/vendor/css/theme-default.css" />
  <link rel="stylesheet" href="assets/css/demo.css" />
  
  <!-- Vendors CSS -->
  <link rel="stylesheet" href="assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
  <link rel="stylesheet" href="assets/vendor/css/pages/page-auth.css" />
  
  <!-- Helpers -->
  <script src="assets/vendor/js/helpers.js"></script>
  <script src="assets/js/config.js"></script>
</head>

<body>
  <!-- Content -->
  <div class="container-xxl">
    <div class="authentication-wrapper authentication-basic container-p-y">
      <div class="authentication-inner">
        <!-- Register -->
        <div class="card px-sm-6 px-0">
          <div class="card-body">
            <!-- Logo -->
            <div class="app-brand justify-content-center">
              <a href="home.html" class="app-brand-link gap-2">
                <span class="app-brand-logo demo">
                  <!-- SVG logo -->
                </span>
                <span class="app-brand-text demo text-heading fw-bold">MediTrack</span>
              </a>
            </div>
            <!-- /Logo -->
            <h4 class="mb-1">Welcome to MediTrack! ðŸ‘‹</h4>
            <p class="mb-6">Please sign-in to your account</p>
            
            <!-- Login Form -->
            <form id="loginForm" class="mb-6">
              <div class="mb-6">
                <label for="email" class="form-label">Email or Username</label>
                <input type="text" class="form-control" id="email" name="email" placeholder="Enter your email or username" autofocus required />
              </div>
              <div class="mb-6 form-password-toggle">
                <label class="form-label" for="password">Password</label>
                <div class="input-group input-group-merge">
                  <input type="password" id="password" class="form-control" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required />
                  <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                </div>
              </div>
              <div class="mb-6">
                <button class="btn btn-primary d-grid w-100" type="submit">Login</button>
              </div>
            </form>
            
            <p class="text-center">
              <span>New on our platform?</span>
              <a href="/MediTrack/pages/auth-register.html">Create an account</a>
            </p>
          </div>
        </div>
        <!-- /Register -->
      </div>
    </div>
  </div>
  <!-- /Content -->
  
  <!-- Core JS -->
  <script src="assets/vendor/libs/jquery/jquery.js"></script>
  <script src="assets/vendor/libs/popper/popper.js"></script>
  <script src="assets/vendor/js/bootstrap.js"></script>
  <script src="assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="assets/vendor/js/menu.js"></script>
  
  <!-- Main JS -->
  <script src="assets/js/main.js"></script>
  
  <!-- JavaScript for login logic -->
  <script>
    document.getElementById('loginForm').addEventListener('submit', function(event) {
      event.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const errorMessage = document.getElementById('error-message');
      const loader = document.getElementById('loader');
  
      loader.style.display = 'block'; // Show loader
  
      // Send the email as a query parameter
      fetch(`http://203.161.49.218:1337/api/users?filters[email][$eq]=${encodeURIComponent(email)}`, {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer d68ab99a384e85007a4588d4f9c6cfcb438b2e1bf3298a057a93175310e642dfc7e8bd304d1e34cab68ad1e1b98a7745f60ddf0254f71c258f6bda92a8e3e9a6ffa3daa8ca4c4ccce8dff5435b9f4180e22de31961ca0a3729232633a9bb415b5ed03624662dd8b4b09551bd3b458ec051e5957c617955a69bdec568c1967d5b',
          'Content-Type': 'application/json'
        }
      })
      .then(response => {
        loader.style.display = 'none'; // Hide loader
  
        if (!response.ok) {
          throw new Error('User not found or server error');
        }
  
        return response.json();
      })
      .then(data => {
        if (!data || data.data.length === 0) {
          errorMessage.textContent = 'Login failed: Invalid credentials';
          return;
        }
  
        const user = data.data[0].attributes;
  
        // Debugging: Display entered and stored password for comparison
        console.log('Stored password:', user.pwd);
        console.log('Entered password:', password);
  
        if (user.pwd && user.pwd === password) {
          // Redirect to dashboard if password matches
          window.location.href = './pages/dashboard.php';
        } else {
          // Password mismatch
          errorMessage.textContent = 'Login failed: Invalid credentials';
        }
      })
      .catch(error => {
        // Log error and show message to the user
        console.error('Error:', error);
        errorMessage.textContent = 'An error occurred during login: ' + error.message;
        loader.style.display = 'none'; // Hide loader
      });
    });
  </script>
  
</body>
</html>
